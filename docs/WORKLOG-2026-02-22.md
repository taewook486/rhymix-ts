# Work Log - 2026-02-22

## 작업 개요
Rhymix-TS 프로젝트 관리자 페이지 및 인증 기능 수정

## 수정된 버그

### 1. 인증 페이지 버그 수정
- **Signin 폼 중앙 정렬**
  - 파일: `app/(auth)/layout.tsx`
  - 수정: flex 컨테이너에 `p-4` 패딩 추가
  - 결과: signin 폼이 페이지 중앙에 정렬됨

- **OAuth 콜백 핸들러 생성**
  - 파일: `app/auth/callback/route.ts` (신규)
  - 기능: Google/GitHub OAuth 로그인 콜백 처리
  - 참고: Supabase Dashboard에서 OAuth 제공자 활성화 필요

- **비밀번호 재설정 페이지 404 수정**
  - 파일: `app/[locale]/(auth)/reset-password/page.tsx` (신규)
  - 수정: locale 경로 지원 추가
  - 결과: `/ko/reset-password`, `/en/reset-password` 등 정상 작동

- **미들웨어 경로 업데이트**
  - 파일: `middleware.ts`
  - 수정: I18N_EXCLUDED_PATHS에 `/reset-password`, `/auth` 추가

### 2. 관리자 Settings 페이지 수정
- **SettingsForm 컴포넌트 구조 수정**
  - 파일: `app/(admin)/admin/settings/SettingsForm.tsx`
  - 문제: `SettingsForm.SEOSettings` 패턴이 React Client Component에서 작동하지 않음
  - 수정:
    - `SettingsForm.SEOSettings` → `export function SEOSettings`
    - `SettingsForm.RegistrationSettings` → `export function RegistrationSettings`
  - 파일: `app/(admin)/admin/settings/page.tsx`
  - 수정: import 문을 named exports로 변경

## 신규 생성 페이지

### 1. Media Library (`/admin/media`)
- 파일: `app/(admin)/admin/media/page.tsx`
- 기능:
  - 파일 업로드 UI (드래그 앤 드롭)
  - 미디어 파일 테이블 (이미지, 비디오, 오디오, PDF)
  - 파일 크기 포맷팅, 타입 아이콘
  - 통계 카드 (총 파일, 저장공간, 오늘 업로드)

### 2. Widgets (`/admin/widgets`)
- 파일: `app/(admin)/admin/widgets/page.tsx`
- 기능:
  - 위치별 위젯 관리 (Header, Sidebar, Content, Footer)
  - 위젯 활성/비활성 상태 표시
  - 드래그 앤 드롭 순서 변경 UI
  - 통계 카드 (총 위젯, 활성, 비활성)

### 3. Themes (`/admin/themes`)
- 파일: `app/(admin)/admin/themes/page.tsx`
- 기능:
  - 테마 카드 그리드
  - 활성 테마 표시
  - 다크 모드 지원 표시
  - 반응형 아이콘

## 인터랙티브 기능 추가

### Themes 페이지 기능
- **Server Actions**: `app/actions/theme.ts`
  - `getThemes()`: 모든 테마 조회
  - `activateTheme(themeId)`: 테마 활성화
  - `getActiveTheme()`: 활성 테마 조회

- **Client Components**:
  - `components/admin/ThemeCard.tsx`
    - Activate 버튼 (테마 활성화)
    - Preview 버튼 (새 탭에서 미리보기)
    - 로딩 상태 표시
  - `components/admin/InstallThemeDialog.tsx`
    - 테마 설치 다이얼로그
    - URL 입력 폼

## 파일 구조

### 새로운 액션 파일
- `app/actions/theme.ts` - 테마 관련 server actions
- `app/actions/index.ts` - theme 액션 export 추가

### 새로운 컴포넌트
- `components/admin/ThemeCard.tsx`
- `components/admin/InstallThemeDialog.tsx`
- `components/admin/index.ts` - exports 추가

## 테스트 상태

| 페이지 | 경로 | HTTP 상태 | 상태 |
|--------|------|-----------|------|
| Signin | `/ko/signin` | 200 OK | ✅ |
| Reset Password | `/ko/reset-password` | 200 OK | ✅ |
| Admin Settings | `/admin/settings` | 307 (auth redirect) | ✅ |
| Admin Themes | `/admin/themes` | 307 (auth redirect) | ✅ |
| Admin Media | `/admin/media` | 307 (auth redirect) | ✅ |
| Admin Widgets | `/admin/widgets` | 307 (auth redirect) | ✅ |

## OAuth 테스트 참고사항
Google/GitHub OAuth 로그인은 Supabase Dashboard 설정이 필요:
1. Supabase Dashboard → Authentication → Providers
2. Google/GitHub provider 활성화
3. Callback URL: `https://your-domain.com/auth/callback`
4. Vercel 배포 후 테스트 권장

## TypeScript 컴파일
- 모든 수정사항 TypeScript strict mode 통과
- LSP 에러 없음

## 다음 작업
1. OAuth 공급자 설정 (Supabase Dashboard)
2. Vercel 배포 후 OAuth 테스트
3. site_themes DB 테이블 마이그레이션 생성
4. Media 파일 업로드 기능 실제 구현 (Supabase Storage)
5. Widget 순서 변경 기능 실제 구현

---

## 추가 작업 (오후)

### 3. Navigation 로케일 검증 수정
- **문제**: `/admin/admin` 404 에러
- **원인**: Navigation.tsx가 모든 첫 번째 경로 세그먼트를 로케일로 인식
- **수정**: `components/layout/Navigation.tsx`
  - `locales` 배열 import 추가
  - 로케일 유효성 검증 로직 추가
  - 유효한 로케일일 때만 `localePrefix` 설정
- **결과**: Admin 링크가 `/admin`으로 정상 작동

### 4. 관리자 버튼 기능 구현

#### AddMemberDialog (회원 추가)
- **파일**: `components/admin/AddMemberDialog.tsx`
- **API**: `app/api/admin/members/route.ts`
- **기능**:
  - 이메일, 표시 이름, 역할, 임시 비밀번호 입력
  - Supabase Auth 사용자 생성
  - 프로필 테이블에 사용자 정보 저장
  - 성공/실패 토스트 알림

#### AddGroupDialog (그룹 추가)
- **파일**: `components/admin/AddGroupDialog.tsx`
- **API**: `app/api/admin/groups/route.ts`
- **기능**:
  - 그룹 이름, 설명 입력
  - 그룹 중복 검사
  - 데이터베이스에 그룹 생성

#### AddPageDialog (페이지 추가)
- **파일**: `components/admin/AddPageDialog.tsx`
- **API**: `app/api/admin/pages/route.ts`
- **기능**:
  - 제목, 슬러그, 내용, 상태 입력
  - 제목에서 슬러그 자동 생성
  - 슬러그 중복 검사
  - Draft/Published 상태 선택

#### AddPermissionDialog (권한 추가)
- **파일**: `components/admin/AddPermissionDialog.tsx`
- **API**: `app/api/admin/permissions/route.ts`
- **기능**:
  - 권한 이름, 모듈, 설명 입력
  - 모듈 선택 (board, member, document, etc.)
  - 권한 중복 검사

#### InstallModuleDialog (모듈 설치)
- **파일**: `components/admin/InstallModuleDialog.tsx`
- **기능**:
  - 모듈 이름, 제목, 설명 입력
  - 패키지 URL 입력 (선택사항)
  - 참고: 파일 시스템 접근 필요하여 실제 설치는 추후 구현

#### AddWidgetDialog (위젯 추가)
- **파일**: `components/admin/AddWidgetDialog.tsx`
- **기능**:
  - 위젯 이름, 제목, 타입, 위치 입력
  - 위젯 타입 선택 (html, text, menu, recent_posts, etc.)
  - 위치 선택 (sidebar_left, header, footer, etc.)
  - 참고: 위젯 렌더러 구현 필요

## Git 커밋 기록
1. `4357957` - fix: validate locale prefix in Navigation to prevent /admin/admin URLs
2. `18eae16` - feat: implement AddMemberDialog and AddGroupDialog components
3. `db667d6` - feat: implement AddPageDialog, AddPermissionDialog, InstallModuleDialog, AddWidgetDialog
